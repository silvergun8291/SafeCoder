rules:
- id: java-sql-injection-string-concatenation-cwe-89
  message: Use parameterized queries instead of string concatenation to prevent SQL injection. The current code is vulnerable to SQL injection attacks (CWE-89).
  severity: ERROR
  languages:
  - java
  metadata:
    cwe: CWE-89
    owasp: A03:2021 - Injection
    references:
    - https://owasp.org/www-project-top-ten/2021/A01_2021-Injection
    rationale: String concatenation in SQL queries can lead to SQL injection vulnerabilities. Attackers can manipulate input values to execute arbitrary SQL code. Use parameterized queries (PreparedStatement) to safely handle user input.
  fix: Connection $CONN = DriverManager.getConnection($X);\n\nPreparedStatement $PSTMT = $CONN.prepareStatement("SELECT * FROM $TABLE WHERE $COLUMN = ?");\n\n$PSTMT.setString(1, $USER_INPUT);\n\n$PSTMT.executeQuery();
  pattern-inside: |
    public ResultSet $METHOD_NAME( String $USER_INPUT ) throws SQLException {
      ...
    }
  pattern: |
    Connection $CONN = DriverManager.getConnection($X);
    
    Statement $STMT = $CONN.createStatement();
    
    String $QUERY = "SELECT * FROM $TABLE WHERE $COLUMN = ''''" + $USER_INPUT + "''''";
    
    $STMT.executeQuery($QUERY);