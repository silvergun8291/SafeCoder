rules:
- id: java-sql-injection-string-concatenation-cwe-0
  message: 'Use parameterized queries (PreparedStatement) instead of string concatenation
    to prevent SQL injection. Hardcoded credentials should be externalized to environment
    variables or secret management systems.

    '
  severity: ERROR
  languages:
  - java
  metadata:
    cwe: 0
    owasp: A03:2021 - Injection
    references:
    - https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html
    rationale: "String concatenation in SQL queries is vulnerable to SQL injection\
      \ attacks. \nThis rule enforces the use of parameterized queries (PreparedStatement)\
      \ \nand externalization of database credentials to prevent both SQL injection\
      \ \nand hardcoded credential issues (CWE-798).\n"
  fix: "// Validate input against allowlist\nif (userId == null || !USER_ID_PATTERN.matcher(userId).matches())\
    \ {\n    throw new IllegalArgumentException(\"Invalid user ID format\");\n}\n\n\
    // Retrieve credentials securely\nString dbUrl = System.getenv(\"DB_URL\");\n\
    String dbUser = System.getenv(\"DB_USER\");\nString dbPassword = System.getenv(\"\
    DB_PASSWORD\");\n\nif (dbUrl == null || dbUser == null || dbPassword == null)\
    \ {\n    throw new IllegalStateException(\"Database credentials not configured\"\
    );\n}\n\n// Use try-with-resources and parameterized query\ntry (Connection conn\
    \ = DriverManager.getConnection(dbUrl, dbUser, dbPassword);\n     PreparedStatement\
    \ pstmt = conn.prepareStatement(\"SELECT * FROM users WHERE id = ?\")) {\n   \
    \ \n    pstmt.setString(1, userId);\n    \n    return pstmt.executeQuery();\n\
    } catch (SQLException e) {\n    System.err.println(\"Database error occurred:\
    \ \" + e.getMessage());\n    throw e;\n}\n"
  pattern-inside: public ResultSet * (String userId) throws SQLException
  pattern: 'Connection conn = DriverManager.getConnection($URL, $USER, $PASS);

      Statement stmt = conn.createStatement();

      String query = "SELECT * FROM users WHERE id = \''''''''" + userId + "''''''''";

      return stmt.executeQuery(query);'
- id: java-os-command-injection-runtime-exec-cwe-0
  message: 'Avoid using Runtime.getRuntime().exec() with string concatenation to prevent
    OS command injection. Use ProcessBuilder with input validation and absolute command
    paths instead.

    '
  severity: ERROR
  languages:
  - java
  metadata:
    cwe: 0
    owasp: A03:2021 - Injection
    references:
    - https://cheatsheetseries.owasp.org/cheatsheets/OS_Command_Injection_Defense_Cheat_Sheet.html
    rationale: "Using Runtime.getRuntime().exec() with user-controlled input is vulnerable\
      \ to OS command injection.\nThis rule enforces the use of ProcessBuilder with\
      \ input validation and absolute command paths \nto prevent command injection\
      \ attacks (CWE-78).\n"
  fix: "// Input validation against allowlist\nif (userInput == null || !VALID_PING_TARGET.matcher(userInput).matches())\
    \ {\n    throw new IllegalArgumentException(\"Invalid ping target: \" + userInput);\n\
    }\n\n// Use ProcessBuilder with absolute path and argument array\nProcessBuilder\
    \ processBuilder = new ProcessBuilder(PING_COMMAND, userInput);\n\n// Set secure\
    \ defaults\nprocessBuilder.redirectErrorStream(true);\nprocessBuilder.directory(new\
    \ File(System.getProperty(\"java.io.tmpdir\")));\n\ntry {\n    Process process\
    \ = processBuilder.start();\n    \n    // Read process output if needed\n    try\
    \ (BufferedReader reader = new BufferedReader(\n            new InputStreamReader(process.getInputStream())))\
    \ {\n        String line;\n        while ((line = reader.readLine()) != null)\
    \ {\n            System.out.println(line);\n        }\n    }\n    \n    int exitCode\
    \ = process.waitFor();\n    if (exitCode != 0) {\n        System.err.println(\"\
    Command failed with exit code: \" + exitCode);\n    }\n} catch (InterruptedException\
    \ e) {\n    Thread.currentThread().interrupt();\n    throw new IOException(\"\
    Command execution interrupted\", e);\n}"
  pattern-inside: public void * (String userInput) throws IOException
  pattern: Runtime.getRuntime().exec("ping " + userInput);