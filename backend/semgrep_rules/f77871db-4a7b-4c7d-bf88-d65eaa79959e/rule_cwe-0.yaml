rules:
- id: java-sql-injection-cwe-0
  message: Use parameterized queries instead of string concatenation for SQL queries to prevent SQL injection.
  severity: ERROR
  languages:
  - java
  metadata:
    cwe: 0
    owasp: A01:2021-Injection
    rationale: String concatenation in SQL queries can lead to SQL injection vulnerabilities. Use `PreparedStatement` with parameterized queries to safely handle user input.
  fix: |-
    Connection $CONN = DriverManager.getConnection($X);
    String $QUERY = "..." + "?" + "...";
    PreparedStatement $PSTMT = $CONN.prepareStatement($QUERY);
    $PSTMT.setString(1, $INPUT);
    $PSTMT.executeQuery();
  pattern-inside: |
    public ResultSet $METHOD($X) throws SQLException {
      ...
    }
  pattern: |-
    Connection $CONN = DriverManager.getConnection($X);
    Statement $STMT = $CONN.createStatement();
    String $QUERY = "..." + $INPUT + "...";
    $STMT.executeQuery($QUERY);
- id: java-os-command-injection-cwe-0
  message: Use ProcessBuilder with validated input instead of Runtime.exec for command execution to prevent OS command injection.
  severity: ERROR
  languages:
  - java
  metadata:
    cwe: 0
    owasp: A01:2021-Injection
    rationale: Using `Runtime.exec` with string concatenation can lead to OS command injection vulnerabilities. Use `ProcessBuilder` with an argument array and validate input against an allowlist to safely execute commands.
  fix: |-
    ProcessBuilder processBuilder = new ProcessBuilder("...", $INPUT);
    processBuilder.redirectErrorStream(true);
    processBuilder.directory(new File(System.getProperty("java.io.tmpdir")));
    Process process = processBuilder.start();
    int exitCode = process.waitFor();
  pattern-inside: |
    public void $METHOD($X) throws IOException {
      ...
    }
  pattern: Runtime.getRuntime().exec("..." + $INPUT + "...");